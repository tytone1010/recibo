<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>ORDEN DE VENTA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://luisteruelhn.github.io/PLANTILLA/style.css">
</head>

<body>
  <header>
    <h1>ORDEN DE VENTA</h1>
    <address>
      <p>TYT System's</p>
      <p>Santa Bárbara, Honduras</p>
      <p>Tel. 9517-4747</p>
    </address>
    <div style="float: right;">
      <img src="https://luisteruelhn.github.io/PLANTILLA/logo.png" alt="logo" style="width:100px;">
    </div>
  </header>

  <article>
    <table class="meta">
      <tr><th>ID Orden</th><td><span id="idORDENVENTAS"></span></td></tr>
      <tr><th>ID Venta</th><td><span id="idventas"></span></td></tr>
      <tr><th>Estado</th><td><span id="ESTADO"></span></td></tr>
      <tr><th>Total</th><td>L <span id="TOTAL"></span></td></tr>
    </table>

    <h3>Detalles del Producto</h3>
    <table class="inventory">
      <thead>
        <tr>
          <th>Categoría</th>
          <th>Nombre</th>
          <th>Cantidad</th>
          <th>Precio</th>
          <th>Subtotal</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td id="CATEGORIA"></td>
          <td id="NOMBRE"></td>
          <td id="CANTIDAD" style="text-align:center;"></td>
          <td id="PRECIO" style="text-align:right;"></td>
          <td id="SUBTOTAL" style="text-align:right;"></td>
        </tr>
      </tbody>
    </table>

    <table class="balance">
      <tr><th>Total</th><td>L <span id="TOTAL2"></span></td></tr>
    </table>
  </article>

  <aside>
    <h1>Notas</h1>
    <p>Gracias por su compra. ¡Vuelva pronto!</p>
  </aside>

<script>
/* ======================================================
   CONFIGURACIÓN GENERAL
====================================================== */
const params = new URLSearchParams(window.location.search);
const id = params.get("id");

/* ======================================================
   MODO NUEVO: URL CORTA (?id=XXXX)
====================================================== */
if (id) {
  fetch("https://script.google.com/macros/s/AKfycbXXXX/exec?id=" + encodeURIComponent(id))
    .then(r => r.json())
    .then(data => {
      if (!data || Object.keys(data).length === 0) return;

      Object.keys(data).forEach(c => {
        const el = document.getElementById(c);
        if (el && data[c] !== null) {
          el.textContent = data[c];
        }
      });

      // Cálculos
      const cant = parseFloat(data.CANTIDAD || 0);
      const precio = parseFloat(data.PRECIO || 0);
      const subtotal = cant * precio;

      document.getElementById("SUBTOTAL").textContent = subtotal.toFixed(2);
      document.getElementById("TOTAL2").textContent =
        data.TOTAL ? Number(data.TOTAL).toFixed(2) : subtotal.toFixed(2);
    });

  // ⛔ salir para no ejecutar el modo viejo
  return;
}

/* ======================================================
   MODO VIEJO: URL LARGA (parámetros normales)
====================================================== */
const campos = [
  "idORDENVENTAS",
  "idventas",
  "ESTADO",
  "TOTAL",
  "CATEGORIA",
  "NOMBRE",
  "CANTIDAD",
  "PRECIO"
];

campos.forEach(c => {
  const valor = params.get(c);
  if (valor) {
    const el = document.getElementById(c);
    if (el) el.textContent = decodeURIComponent(valor);
  }
});

// Cálculos modo viejo
const cant = parseFloat(params.get("CANTIDAD") || 0);
const precio = parseFloat(params.get("PRECIO") || 0);
const subtotal = cant * precio;

document.getElementById("SUBTOTAL").textContent = subtotal.toFixed(2);
document.getElementById("TOTAL2").textContent =
  params.get("TOTAL")
    ? Number(params.get("TOTAL")).toFixed(2)
    : subtotal.toFixed(2);
</script>

</body>
</html>

